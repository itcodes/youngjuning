---
title: ä¸€ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆçš„Dockerå­¦ä¹ ç¬”è®°
date: 2020-03-31 00:23:31
categories:
  - [è¿ç»´, Docker]
tags:
  - [å­¦ä¹ ç¬”è®°]
---

![](https://i.loli.net/2020/03/31/UI9JSTCENRvqDwY.png)

<!--more-->

Docker æ˜¯ä¸ªåˆ’æ—¶ä»£çš„å¼€æºé¡¹ç›®ï¼Œå®ƒå½»åº•é‡Šæ”¾äº†è®¡ç®—è™šæ‹ŸåŒ–çš„å¨åŠ›ï¼Œæå¤§æé«˜äº†åº”ç”¨çš„ç»´æŠ¤æ•ˆç‡ï¼Œé™ä½äº†äº‘è®¡ç®—åº”ç”¨å¼€å‘çš„æˆæœ¬ï¼ä½¿ç”¨ Dockerï¼Œå¯ä»¥è®©åº”ç”¨çš„éƒ¨ç½²ã€æµ‹è¯•å’Œåˆ†å‘éƒ½å˜å¾—å‰æ‰€æœªæœ‰çš„é«˜æ•ˆå’Œè½»æ¾ï¼

æ— è®ºæ˜¯åº”ç”¨å¼€å‘è€…ã€è¿ç»´äººå‘˜ã€è¿˜æ˜¯å…¶ä»–ä¿¡æ¯æŠ€æœ¯ä»ä¸šäººå‘˜ï¼Œéƒ½æœ‰å¿…è¦è®¤è¯†å’ŒæŒæ¡ Dockerï¼ŒèŠ‚çº¦æœ‰é™çš„ç”Ÿå‘½ã€‚

æœ¬æ–‡æ˜¯ç¬”è€…ä»¥ä¸€ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆçš„è§†è§’å­¦ä¹  Docker è¿‡ç¨‹ä¸­çš„ç¬”è®°ï¼Œå¦‚æœå¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ï¼Œè£å¹¸ä¹‹è‡³ã€‚

## Docker ç®€ä»‹

**Docker** ä½¿ç”¨ `Google` å…¬å¸æ¨å‡ºçš„ [Go è¯­è¨€](https://golang.org/) è¿›è¡Œå¼€å‘å®ç°ï¼ŒåŸºäº `Linux` å†…æ ¸çš„ [cgroup](https://zh.wikipedia.org/wiki/Cgroups)ï¼Œ[namespace](https://en.wikipedia.org/wiki/Linux_namespaces)ï¼Œä»¥åŠ [OverlayFS](https://docs.docker.com/storage/storagedriver/overlayfs-driver/) ç±»çš„ [Union FS](https://en.wikipedia.org/wiki/Union_mount) ç­‰æŠ€æœ¯ï¼Œå¯¹è¿›ç¨‹è¿›è¡Œå°è£…éš”ç¦»ï¼Œå±äº [æ“ä½œç³»ç»Ÿå±‚é¢çš„è™šæ‹ŸåŒ–æŠ€æœ¯](https://en.wikipedia.org/wiki/Operating-system-level_virtualization)ã€‚ç”±äºéš”ç¦»çš„è¿›ç¨‹ç‹¬ç«‹äºå®¿ä¸»å’Œå…¶å®ƒçš„éš”ç¦»çš„è¿›ç¨‹ï¼Œå› æ­¤ä¹Ÿç§°å…¶ä¸ºå®¹å™¨ã€‚æœ€åˆå®ç°æ˜¯åŸºäº [LXC](https://linuxcontainers.org/lxc/introduction/)ï¼Œä» 0.7 ç‰ˆæœ¬ä»¥åå¼€å§‹å»é™¤ `LXC`ï¼Œè½¬è€Œä½¿ç”¨è‡ªè¡Œå¼€å‘çš„ [libcontainer](https://github.com/docker/libcontainer)ï¼Œä» 1.11 å¼€å§‹ï¼Œåˆ™è¿›ä¸€æ­¥æ¼”è¿›ä¸ºä½¿ç”¨ [runC](https://github.com/opencontainers/runc) å’Œ [containerd](https://github.com/containerd/containerd)ã€‚

## Docker æ ¸å¿ƒæ¦‚å¿µ

### é•œåƒï¼ˆImageï¼‰

æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ“ä½œç³»ç»Ÿåˆ†ä¸ºå†…æ ¸å’Œç”¨æˆ·ç©ºé—´ã€‚å¯¹äº Linux è€Œè¨€ï¼Œå†…æ ¸å¯åŠ¨åï¼Œä¼šæŒ‚è½½ `root` æ–‡ä»¶ç³»ç»Ÿä¸ºå…¶æä¾›ç”¨æˆ·ç©ºé—´æ”¯æŒã€‚è€Œ Docker é•œåƒï¼ˆImageï¼‰ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ª `root` æ–‡ä»¶ç³»ç»Ÿã€‚æ¯”å¦‚å®˜æ–¹é•œåƒ `ubuntu:18.04` å°±åŒ…å«äº†å®Œæ•´çš„ä¸€å¥— Ubuntu 18.04 æœ€å°ç³»ç»Ÿçš„ `root` æ–‡ä»¶ç³»ç»Ÿã€‚

Docker é•œåƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼‰ã€‚é•œåƒä¸åŒ…å«ä»»ä½•åŠ¨æ€æ•°æ®ï¼Œå…¶å†…å®¹åœ¨æ„å»ºä¹‹åä¹Ÿä¸ä¼šè¢«æ”¹å˜ã€‚

### å®¹å™¨ï¼ˆContainerï¼‰

é•œåƒï¼ˆ`Image`ï¼‰å’Œå®¹å™¨ï¼ˆ`Container`ï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ `ç±»` å’Œ `å®ä¾‹` ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰ã€‚

å®¹å™¨çš„å®è´¨æ˜¯è¿›ç¨‹ï¼Œä½†ä¸ç›´æ¥åœ¨å®¿ä¸»æ‰§è¡Œçš„è¿›ç¨‹ä¸åŒï¼Œå®¹å™¨è¿›ç¨‹è¿è¡Œäºå±äºè‡ªå·±çš„ç‹¬ç«‹çš„ [å‘½åç©ºé—´](https://en.wikipedia.org/wiki/Linux_namespaces)ã€‚å› æ­¤å®¹å™¨å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„ `root` æ–‡ä»¶ç³»ç»Ÿã€è‡ªå·±çš„ç½‘ç»œé…ç½®ã€è‡ªå·±çš„è¿›ç¨‹ç©ºé—´ï¼Œç”šè‡³è‡ªå·±çš„ç”¨æˆ· ID ç©ºé—´ã€‚å®¹å™¨å†…çš„è¿›ç¨‹æ˜¯è¿è¡Œåœ¨ä¸€ä¸ªéš”ç¦»çš„ç¯å¢ƒé‡Œï¼Œä½¿ç”¨èµ·æ¥ï¼Œå°±å¥½åƒæ˜¯åœ¨ä¸€ä¸ªç‹¬ç«‹äºå®¿ä¸»çš„ç³»ç»Ÿä¸‹æ“ä½œä¸€æ ·ã€‚è¿™ç§ç‰¹æ€§ä½¿å¾—å®¹å™¨å°è£…çš„åº”ç”¨æ¯”ç›´æ¥åœ¨å®¿ä¸»è¿è¡Œæ›´åŠ å®‰å…¨ã€‚ä¹Ÿå› ä¸ºè¿™ç§éš”ç¦»çš„ç‰¹æ€§ï¼Œå¾ˆå¤šäººåˆå­¦ Docker æ—¶å¸¸å¸¸ä¼šæ··æ·†å®¹å™¨å’Œè™šæ‹Ÿæœºã€‚

å‰é¢è®²è¿‡é•œåƒä½¿ç”¨çš„æ˜¯åˆ†å±‚å­˜å‚¨ï¼Œå®¹å™¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ¯ä¸€ä¸ªå®¹å™¨è¿è¡Œæ—¶ï¼Œæ˜¯ä»¥é•œåƒä¸ºåŸºç¡€å±‚ï¼Œåœ¨å…¶ä¸Šåˆ›å»ºä¸€ä¸ªå½“å‰å®¹å™¨çš„å­˜å‚¨å±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç§°è¿™ä¸ªä¸ºå®¹å™¨è¿è¡Œæ—¶è¯»å†™è€Œå‡†å¤‡çš„å­˜å‚¨å±‚ä¸º **å®¹å™¨å­˜å‚¨å±‚**ã€‚

å®¹å™¨å­˜å‚¨å±‚çš„ç”Ÿå­˜å‘¨æœŸå’Œå®¹å™¨ä¸€æ ·ï¼Œå®¹å™¨æ¶ˆäº¡æ—¶ï¼Œå®¹å™¨å­˜å‚¨å±‚ä¹Ÿéšä¹‹æ¶ˆäº¡ã€‚å› æ­¤ï¼Œä»»ä½•ä¿å­˜äºå®¹å™¨å­˜å‚¨å±‚çš„ä¿¡æ¯éƒ½ä¼šéšå®¹å™¨åˆ é™¤è€Œä¸¢å¤±ã€‚

æŒ‰ç…§ Docker æœ€ä½³å®è·µçš„è¦æ±‚ï¼Œå®¹å™¨ä¸åº”è¯¥å‘å…¶å­˜å‚¨å±‚å†…å†™å…¥ä»»ä½•æ•°æ®ï¼Œå®¹å™¨å­˜å‚¨å±‚è¦ä¿æŒæ— çŠ¶æ€åŒ–ã€‚æ‰€æœ‰çš„æ–‡ä»¶å†™å…¥æ“ä½œï¼Œéƒ½åº”è¯¥ä½¿ç”¨ [æ•°æ®å·ï¼ˆVolumeï¼‰](https://vuepress.mirror.docker-practice.com/data_management/volume.html)ã€æˆ–è€…ç»‘å®šå®¿ä¸»ç›®å½•ï¼Œåœ¨è¿™äº›ä½ç½®çš„è¯»å†™ä¼šè·³è¿‡å®¹å™¨å­˜å‚¨å±‚ï¼Œç›´æ¥å¯¹å®¿ä¸»ï¼ˆæˆ–ç½‘ç»œå­˜å‚¨ï¼‰å‘ç”Ÿè¯»å†™ï¼Œå…¶æ€§èƒ½å’Œç¨³å®šæ€§æ›´é«˜ã€‚

æ•°æ®å·çš„ç”Ÿå­˜å‘¨æœŸç‹¬ç«‹äºå®¹å™¨ï¼Œå®¹å™¨æ¶ˆäº¡ï¼Œæ•°æ®å·ä¸ä¼šæ¶ˆäº¡ã€‚å› æ­¤ï¼Œä½¿ç”¨æ•°æ®å·åï¼Œå®¹å™¨åˆ é™¤æˆ–è€…é‡æ–°è¿è¡Œä¹‹åï¼Œæ•°æ®å´ä¸ä¼šä¸¢å¤±ã€‚

### ä»“åº“æ³¨å†ŒæœåŠ¡å™¨ï¼ˆRegistryï¼‰

ä¸€ä¸ª **Docker Registry** ä¸­å¯ä»¥åŒ…å«å¤šä¸ª **ä»“åº“**ï¼ˆ`Repository`ï¼‰ï¼›æ¯ä¸ªä»“åº“å¯ä»¥åŒ…å«å¤šä¸ª **æ ‡ç­¾**ï¼ˆ`Tag`ï¼‰ï¼›æ¯ä¸ªæ ‡ç­¾å¯¹åº”ä¸€ä¸ªé•œåƒã€‚

é€šå¸¸ï¼Œä¸€ä¸ªä»“åº“ä¼šåŒ…å«åŒä¸€ä¸ªè½¯ä»¶ä¸åŒç‰ˆæœ¬çš„é•œåƒï¼Œè€Œæ ‡ç­¾å°±å¸¸ç”¨äºå¯¹åº”è¯¥è½¯ä»¶çš„å„ä¸ªç‰ˆæœ¬ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ `<ä»“åº“å>:<æ ‡ç­¾>` çš„æ ¼å¼æ¥æŒ‡å®šå…·ä½“æ˜¯è¿™ä¸ªè½¯ä»¶å“ªä¸ªç‰ˆæœ¬çš„é•œåƒã€‚å¦‚æœä¸ç»™å‡ºæ ‡ç­¾ï¼Œå°†ä»¥ `latest` ä½œä¸ºé»˜è®¤æ ‡ç­¾ã€‚

ä»¥ [Ubuntu é•œåƒ](https://hub.docker.com/_/ubuntu) ä¸ºä¾‹ï¼Œ`ubuntu` æ˜¯ä»“åº“çš„åå­—ï¼Œå…¶å†…åŒ…å«æœ‰ä¸åŒçš„ç‰ˆæœ¬æ ‡ç­¾ï¼Œå¦‚ï¼Œ`16.04`, `18.04`ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ `ubuntu:16.04`ï¼Œæˆ–è€… `ubuntu:18.04` æ¥å…·ä½“æŒ‡å®šæ‰€éœ€å“ªä¸ªç‰ˆæœ¬çš„é•œåƒã€‚å¦‚æœå¿½ç•¥äº†æ ‡ç­¾ï¼Œæ¯”å¦‚ `ubuntu`ï¼Œé‚£å°†è§†ä¸º `ubuntu:latest`ã€‚

ä»“åº“åç»å¸¸ä»¥ *ä¸¤æ®µå¼è·¯å¾„* å½¢å¼å‡ºç°ï¼Œæ¯”å¦‚ `jwilder/nginx-proxy`ï¼Œå‰è€…å¾€å¾€æ„å‘³ç€ Docker Registry å¤šç”¨æˆ·ç¯å¢ƒä¸‹çš„ç”¨æˆ·åï¼Œåè€…åˆ™å¾€å¾€æ˜¯å¯¹åº”çš„è½¯ä»¶åã€‚ä½†è¿™å¹¶éç»å¯¹ï¼Œå–å†³äºæ‰€ä½¿ç”¨çš„å…·ä½“ Docker Registry çš„è½¯ä»¶æˆ–æœåŠ¡ã€‚

**å…¬æœ‰ Docker Registryï¼š**

- [Docker Hub](https://hub.docker.com/)
- [ç½‘æ˜“äº‘é•œåƒæœåŠ¡](https://c.163.com/hub#/m/library/)
- [DaoCloud é•œåƒå¸‚åœº](https://hub.daocloud.io/)
- [aliyuné•œåƒåº“](https://cr.console.aliyun.com/)

**ç§æœ‰ Docker Registryï¼š**

- [Sonatype Nexus](https://vuepress.mirror.docker-practice.com/repository/nexus3_registry.html)
- [Harbor](https://github.com/goharbor/harbor)

## å®‰è£…é…ç½®

- æ“ä½œç³»ç»Ÿï¼šLinux ubuntu18 4.15.0-91-genericï¼Œé€šè¿‡ `uname -a` æŸ¥çœ‹
- docker-ceé•œåƒï¼šhttps://developer.aliyun.com/mirror/docker-ce?spm=a2c6h.13651102.0.0.52471b11cIp2pH

### å¸è½½æ—§ç‰ˆæœ¬

```shell
$ apt remove docker docker-engine docker.io containerd runc
```

### é€šè¿‡è½¯ä»¶åŒ…å®‰è£…

```shell
# step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·
sudo apt-get update
sudo apt-get -y install apt-transport-https ca-certificates curl gnupg-agent pass software-properties-common
# step 2: å®‰è£…GPGè¯ä¹¦
curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -
# Step 3: å†™å…¥è½¯ä»¶æºä¿¡æ¯
sudo add-apt-repository "deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable"
# Step 4: æ›´æ–°å¹¶å®‰è£…Docker-CE
sudo apt-get -y update
sudo apt-get -y install docker-ce
```

### é€šè¿‡è„šæœ¬å®‰è£…

```shell
$ curl -fsSL https://get.docker.com -o get-docker.sh
$ sudo sh get-docker.sh --mirror Aliyun
```

å®‰è£…æˆåŠŸåï¼Œä¼šè‡ªåŠ¨å¯åŠ¨ Docker æœåŠ¡ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨ `systemctl is-enabled docker` æ¥ç¡®è®¤ Docker æœåŠ¡æ˜¯å¦æ˜¯å¼€æœºè‡ªå¯åŠ¨ã€‚

### å¯é€‰é…ç½®

**è§£å†³ `WARNING: Your kernel does not support cgroup swap limit capabilities`ï¼š**

1ã€ç¼–è¾‘ `/etc/default/grub` æ–‡ä»¶

```shell
$ nano /etc/default/grub
```

2ã€æ‰¾åˆ° `GRUB_CMDLINE_LINUX=` é…ç½®é¡¹ï¼Œå¹¶è¿½åŠ  `cgroup_enable=memory swapaccount=1`ã€‚

3ã€ä¿å­˜æ–‡ä»¶åæ‰§è¡Œä¸€ä¸‹å‘½ä»¤ï¼š`sudo update-grub`

4ã€é‡å¯æœåŠ¡å™¨ï¼š`reboot`

### æµ‹è¯• Docker æ˜¯å¦å®‰è£…æ­£ç¡®

```shell
$ docker run hello-world
```

<details>
<summary>æ‰§è¡Œä»¥ä¸Šå‘½ä»¤ï¼Œè‹¥èƒ½æ­£å¸¸è¾“å‡ºä¿¡æ¯ï¼Œåˆ™è¯´æ˜å®‰è£…æˆåŠŸã€‚</summary>

```shell
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
1b930d010525: Pull complete
Digest: sha256:f9dfddf63636d84ef479d645ab5885156ae030f611a56f3a7ac7f2fdd86d7e4e
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.
    (amd64)
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 $ docker run -it ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
```
</details>

### Docker Deamon é…ç½®

æ‰§è¡Œ `nano /etc/docker/daemon.json` ä¸­å†™å…¥å¦‚ä¸‹å†…å®¹ï¼š

```json
{
  "ip": "127.0.0.1",
  "experimental": false,
  "registry-mirrors": [
    "https://registry.docker-cn.com",
    "https://mirror.ccs.tencentyun.com",
    "http://docker.mirrors.ustc.edu.cn",
    "http://hub-mirror.c.163.com"
  ]
}
```

é‡æ–°å¯åŠ¨æœåŠ¡:

```shell
$ systemctl daemon-reload
$ systemctl restart docker.service
```

## ä½¿ç”¨ Docker é•œåƒ

### è·å–é•œåƒ

> `docker pull [é€‰é¡¹] [Docker Registry åœ°å€[:ç«¯å£å·]/][ç”¨æˆ·å]<ä»“åº“å>[:TAG]`

- é»˜è®¤é€‰é¡¹
  - `-a`ï¼Œ`--all-tags=true|false`ï¼šæ˜¯å¦è·å–ä»“åº“ä¸­çš„æ‰€æœ‰é•œåƒï¼Œé»˜è®¤ä¸ºå¦
  - `--disable-content-trust`ï¼šå–æ¶ˆé•œåƒçš„å†…å®¹æ ¡éªŒï¼Œé»˜è®¤ä¸ºçœŸ
- é»˜è®¤ Docker Registryï¼š`registry.hub.docker.com`
- é»˜è®¤ç”¨æˆ·åï¼š`library`ï¼Œä¹Ÿå°±æ˜¯å®˜æ–¹é•œåƒ
- é»˜è®¤TAGï¼š`latest`

### æŸ¥çœ‹é•œåƒä¿¡æ¯

#### åˆ—å‡ºæœ¬åœ°ä¸»æœºä¸Šå·²æœ‰é•œåƒ

> `docker image ls` | `docker images`

é•œåƒçš„å¤§å°ä¿¡æ¯åªæ˜¯è¡¨ç¤ºäº†è¯¥é•œåƒçš„é€»è¾‘ä½“ç§¯å¤§å°ï¼Œå®é™…ä¸Šç”±äºç›¸åŒçš„é•œåƒå±‚æœ¬åœ°åªä¼šå­˜å‚¨ä¸€ä»½ï¼Œç‰©ç†ä¸Šå ç”¨çš„å­˜å‚¨ç©ºé—´ä¼šå°äºå„é•œåƒé€»è¾‘ä½“ç§¯ä¹‹å’Œã€‚

#### ä½¿ç”¨ tag å‘½ä»¤æ·»åŠ é•œåƒæ ‡ç­¾

> `docker tag ubuntu:latest myubuntu:latest`

ä¸ºäº†æ–¹ä¾¿åœ¨åç»­å·¥ä½œä¸­ä½¿ç”¨ç‰¹å®šé•œåƒï¼Œè¿˜å¯ä»¥ä½¿ç”¨ `docker tag` å‘½ä»¤æ¥ä¸ºæœ¬åœ°é•œåƒä»»æ„æ·»åŠ æ–°çš„æ ‡ç­¾ã€‚

#### ä½¿ç”¨ inspect å‘½ä»¤æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯

> `docker inspect <ä»“åº“>`

ä½¿ç”¨ `docker inspect` å‘½ä»¤å¯ä»¥è·å–è¯¥é•œåƒçš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬åˆ¶ä½œè€…ã€é€‚åº”æ¶æ„ã€å„å±‚çš„æ•°å­—æ‘˜è¦ç­‰ã€‚

#### ä½¿ç”¨ history å‘½ä»¤æŸ¥çœ‹é•œåƒå†å²

>`docker history <REPOSITORY>[:TAG]` æˆ– `docker history <IMAGE ID>`

æ³¨æ„ï¼Œè¿‡é•¿çš„å‘½ä»¤ä¼šè¢«è‡ªåŠ¨æˆªæ–­äº†ï¼Œå¯ä»¥ä½¿ç”¨ `--no-trunc` é€‰é¡¹æ¥è¾“å‡ºå®Œæ•´å‘½ä»¤ã€‚

### åˆ é™¤é•œåƒ

1ã€ä½¿ç”¨æ ‡ç­¾åˆ é™¤é•œåƒ

> `docker rmi <IMAGE> [IMAGE...]` æˆ– `docker image rm <IMAGE> [IMAGE...]`

2ã€ä½¿ç”¨é•œåƒ ID æ¥åˆ é™¤é•œåƒ

> `docker rmi <IMAGE ID>`

å½“ä½¿ç”¨ `docker rmi` å‘½ä»¤ï¼Œå¹¶ä¸”åé¢è·Ÿä¸Šé•œåƒçš„ IDï¼ˆä¹Ÿå¯ä»¥æ˜¯èƒ½è¿›è¡ŒåŒºåˆ†çš„éƒ¨åˆ† ID ä¸²å‰ç¼€ï¼‰æ—¶ï¼Œä¼šå…ˆå°è¯•åˆ é™¤æ‰€æœ‰æŒ‡å‘è¯¥é•œåƒçš„æ ‡ç­¾ï¼Œç„¶ååˆ é™¤è¯¥é•œåƒæ–‡ä»¶æœ¬èº«ã€‚

> æ³¨æ„ï¼Œå½“æœ‰åŸºäºè¯¥é•œåƒåˆ›å»ºçš„å®¹å™¨æ—¶ï¼Œé•œåƒæ–‡ä»¶é»˜è®¤æ˜¯æ— æ³•è¢«åˆ é™¤çš„ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `docker ps -a` å‘½ä»¤å¯ä»¥æŸ¥çœ‹æœ¬æœºä¸Šå­˜åœ¨çš„æ‰€æœ‰å®¹å™¨ã€‚
>
> æœ€ä½³å®è·µï¼šå…ˆç”¨ `docker rm <Container ID>` åˆ é™¤ä¾èµ–è¯¥é•œåƒçš„æ‰€æœ‰å®¹å™¨ï¼Œç„¶åæ‰§è¡Œ `docker rmi <IMAGE ID>` å†æ¥åˆ é™¤é•œåƒã€‚

### æ¸…ç†é•œåƒ

> `docker image prune [options]`
>
> - `-a`ï¼Œ`--all`ï¼šåˆ é™¤æ‰€æœ‰æ— ç”¨é•œåƒï¼Œä¸å…‰æ˜¯ä¸´æ—¶é•œåƒ
> - `-f`,`--force`ï¼šå¼ºåˆ¶åˆ é™¤é•œåƒï¼Œè€Œä¸è¿›è¡Œæç¤ºç¡®è®¤

ä½¿ç”¨ Docker ä¸€æ®µæ—¶é—´åï¼Œç³»ç»Ÿä¸­å¯èƒ½ä¼šé—ç•™ä¸€äº›ä¸´æ—¶çš„é•œåƒæ–‡ä»¶ï¼Œä»¥åŠæ²¡æœ‰ä½¿ç”¨çš„é•œåƒï¼Œå¯ä»¥é€šè¿‡ `docker image prune` å‘½ä»¤æ¥è¿›è¡Œæ¸…ç†ã€‚

æˆ‘ä»¬å¯ä»¥ç»“åˆ crontab æ¥å®šæ—¶æ¸…ç†ï¼Œæ‰§è¡Œ `crontab -e`ï¼Œå†™å…¥ä¸€ä¸‹é…ç½®ï¼š

```shell
# ä¸€å®šè¦è®°å¾—åœ¨åé¢æŒ‰ Enter è¾“å…¥æ¢è¡Œç¬¦ï¼Œå¦åˆ™ä¸ä¼šç”Ÿæ•ˆçš„
59 23 * * * docker image prune -f
```

### åˆ›å»ºé•œåƒ

#### 1ã€åŸºäºå·²æœ‰å®¹å™¨åˆ›å»º

> `docker commit [OPTIONS] <CONTAINER> <REPOSITORY>[:TAG]`
>
> - `-a`ï¼Œ`--author=`ï¼šä½œè€…ä¿¡æ¯
> - `-m`ï¼Œ`--message=""`ï¼šæäº¤ä¿¡æ¯
> - `-p`ï¼Œ`--pause=true`ï¼šæäº¤æ—¶æš‚åœå®¹å™¨æ‰§è¡Œ

é¦–å…ˆï¼Œå¯åŠ¨ä¸€ä¸ª alpine é•œåƒï¼Œå¹¶åœ¨å…¶ä¸­è¿›è¡Œå®‰è£… nano çš„æ“ä½œï¼Œç„¶åå‘å¸ƒä¸€ä¸ªæ–°çš„é•œåƒï¼š

```shell
$ docker run -it alpine bash
$ docker commit -m "install nano" -a "æ¨ä¿Šå®" ff3034d2ffa7 my-alpine:0.1
```

#### 2ã€åŸºäº Dockerfile åˆ›å»º

> `docker build -t <IMAGE NAME> <ä¸Šä¸‹æ–‡è·¯å¾„/URL/->`

é€šè¿‡ Dockerfile åˆ›å»ºæ˜¯æœ€å¸¸è§çš„æ–¹å¼ã€‚Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œåˆ©ç”¨æŒ‡å®šçš„æŒ‡ä»¤æè¿°åŸºäºæŸä¸ªçˆ¶é•œåƒåˆ›å»ºæ–°é•œåƒçš„è¿‡ç¨‹ã€‚

ä¸‹é¢ç»™å‡º Dockerfile çš„ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼ŒåŸºäº alpine é•œåƒå®‰è£… node ç¯å¢ƒï¼Œæ„æˆä¸€ä¸ªæ–°çš„ `youngjuning/alpine` é•œåƒï¼š

```
FROM alpine

LABEL version="1.0" maintainer="youngjuning<youngjuning@aliyun.com>"

RUN sed -i 's/dl-cdn.alpinelinux.org/mirrors.aliyun.com/g' /etc/apk/repositories
```

æ„å»ºï¼š

```shell
$ docker build -t youngjuning/alpine:latest .
```

### å­˜å‚¨é•œåƒ

å¦‚æœè¦å¯¼å‡ºé•œåƒåˆ°æœ¬åœ°æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ `docker save` å‘½ä»¤ã€‚è¯¥å‘½ä»¤æ”¯æŒ `-o <string>` æˆ– `--output <string>` å‚æ•°ï¼Œå¯¼å‡ºé•œåƒåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚

ä¾‹å¦‚ï¼Œå¯¼å‡ºæœ¬åœ° alpine é•œåƒä¸ºæ–‡ä»¶ alpine.tarï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```shell
$ docker save -o alpine.tar alpine
```

ä¹‹åï¼Œç”¨æˆ·å°±å¯ä»¥é€šè¿‡å¤åˆ¶ alpine.tar æ–‡ä»¶å°†è¯¥é•œåƒåˆ†äº«ç»™ä»–äººã€‚

### è½½å…¥é•œåƒ

å¯ä»¥ä½¿ç”¨ `docker load` å°†å¯¼å‡ºçš„ tar æ–‡ä»¶å†å¯¼å…¥åˆ°æœ¬åœ°é•œåƒåº“ã€‚æ”¯æŒ `-i <string>` æˆ– `-input <string>` é€‰é¡¹ï¼Œä»æŒ‡å®šæ–‡ä»¶ä¸­è¯»å…¥é•œåƒå†…å®¹ã€‚

ä¾‹å¦‚ï¼Œä»æ–‡ä»¶ alpine.tar å¯¼å…¥é•œåƒåˆ°æœ¬åœ°é•œåƒåˆ—è¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```shell
$ docker load -i alpine.tar
```

### ä¸Šä¼ é•œåƒ

> `docker push [é€‰é¡¹] [Docker Registry åœ°å€[:ç«¯å£å·]/][ç”¨æˆ·å]<ä»“åº“å>[:TAG]`

**å‘å¸ƒæ–°ç‰ˆæœ¬æµç¨‹ï¼š**

- å‘å¸ƒ latest ç‰ˆæœ¬ï¼š`docker push youngjuning/alpine:latest`
- æ·»åŠ æ–°æ ‡ç­¾ï¼š`docker tag youngjuning/alpine:latest youngjuning/alpine:1.0.0`
- å‘å¸ƒ 1.0.0 ç‰ˆæœ¬ï¼š`docker push youngjuning/alpine:1.0.0`

> å¯ä»¥æŸ¥çœ‹[youngjuning/alpine](https://hub.docker.com/r/youngjuning/alpine)é¡¹ç›®æŸ¥çœ‹æˆ‘å‘å¸ƒçš„åŸºäºaliyuné•œåƒçš„ Aplpine Docker Image

## æ“ä½œ Docker å®¹å™¨

- Docker å®¹å™¨æ˜¯é•œåƒçš„ä¸€ä¸ªè¿è¡Œå®ä¾‹ã€‚
- Docker å®¹å™¨æ˜¯ç‹¬ç«‹è¿è¡Œçš„ä¸€ä¸ªï¼ˆæˆ–ä¸€ç»„ï¼‰åº”ç”¨ï¼Œä»¥åŠå®ƒä»¬å¿…éœ€çš„è¿è¡Œç¯å¢ƒ

### å¯åŠ¨å®¹å™¨

#### 1ã€æ–°å»ºå¹¶å¯åŠ¨

```shell
$ docker run -it ubuntu:18.04 /bin/bash
```

å…¶ä¸­, `-t` é€‰é¡¹è®© Docker åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼ˆpseudo-ttyï¼‰å¹¶ç»‘å®šåˆ°å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¸Šï¼Œ`-i` åˆ™è®©å®¹å™¨çš„æ ‡å‡†è¾“å…¥ä¿æŒæ‰“å¼€ã€‚

å½“åˆ©ç”¨ `docker run` æ¥åˆ›å»ºå®¹å™¨æ—¶ï¼ŒDocker åœ¨åå°è¿è¡Œçš„æ ‡å‡†æ“ä½œåŒ…æ‹¬ï¼š

1. æ£€æŸ¥æœ¬åœ°æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é•œåƒï¼Œä¸å­˜åœ¨å°±ä»å…¬æœ‰ä»“åº“ä¸‹è½½
2. åˆ©ç”¨é•œåƒåˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªå®¹å™¨
3. åˆ†é…ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶åœ¨åªè¯»çš„é•œåƒå±‚å¤–é¢æŒ‚åœ¨ä¸€å±‚å¯è¯»å†™å±‚
4. ä»å®¿ä¸»ä¸»æœºé…ç½®çš„ç½‘æ¡¥æ¥å£ä¸­æ¡¥æ¥ä¸€ä¸ªè™šæ‹Ÿæ¥å£åˆ°å®¹å™¨ä¸­å»
5. ä»åœ°å€æ± é…ç½®ä¸€ä¸ªipåœ°å€ç»™å®¹å™¨
6. æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„åº”ç”¨ç¨‹åº
7. æ‰§è¡Œå®Œæ¯•åå®¹å™¨è¢«ç»ˆæ­¢

**ä¸€äº›å¸¸ç”¨é€‰é¡¹ï¼š**

- `-d`ï¼Œ`--detach=true|false`ï¼šæ˜¯å¦åœ¨åå°è¿è¡Œå®¹å™¨ï¼Œé»˜è®¤ä¸º`false`
- `-i`ï¼Œ`--interactive=true|false`ï¼šä¿æŒæ ‡å‡†è¾“å…¥æ‰“å¼€ï¼Œé»˜è®¤ä¸º `false`
- `-p`ï¼Œ`--publish=[]`ï¼šæŒ‡å®šå¦‚ä½•æ˜ å°„åˆ°æœ¬åœ°ä¸»æœºç«¯å£ï¼Œä¾‹å¦‚ `-p 9000:9000`
- `--restart="no"`ï¼šå®¹å™¨çš„é‡å¯ç­–ç•¥ï¼ŒåŒ…æ‹¬ `no`ã€`on-failure[:max-retry]`ã€`always`ã€`unless-stopped` ç­‰
- `--rm=true|false`ï¼šå®¹å™¨é€€å‡ºåæ˜¯å¦è‡ªåŠ¨åˆ é™¤ï¼Œä¸èƒ½è·Ÿ `-d` åŒæ—¶ä½¿ç”¨
- `-t`ï¼Œ`--tty=true|false`ï¼šæ˜¯å¦åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯ï¼Œé»˜è®¤ä¸º `false`
- `-v [HOST-DIR:]<CONTAINER-DIR>[:OPTIONS]`ï¼Œ`--volume=[HOST-DIR:]<CONTAINER-DIR>[:OPTIONS]`ï¼šæŒ‚åœ¨ä¸»æœºä¸Šçš„æ–‡ä»¶å·åˆ°å®¹å™¨å†…
- `--name=""`ï¼šæŒ‡å®šå®¹å™¨çš„åˆ«å

#### 2ã€å¯åŠ¨å·²ç»ˆæ­¢å®¹å™¨

å¯ä»¥åˆ©ç”¨ `docker start <CONTAINER ID>` å‘½ä»¤ï¼Œç›´æ¥å°†ä¸€ä¸ªå·²ç»ç»ˆæ­¢çš„å®¹å™¨å¯åŠ¨è¿è¡Œã€‚

#### 3ã€æŸ¥çœ‹å®¹å™¨è¾“å‡º

è¦è·å–å®¹å™¨çš„è¾“å‡ºä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ `docker <CONTAINER ID> logs` å‘½ä»¤ã€‚

### ç»ˆæ­¢å®¹å™¨

å¯ä»¥ä½¿ç”¨ `docker stop <CONTAINER ID>` æ¥ç»ˆæ­¢ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ã€‚

å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ï¼Œå¯ä»¥é€šè¿‡ `docker container start` å‘½ä»¤æ¥é‡æ–°å¯åŠ¨ã€‚

æ­¤å¤–ï¼Œ`docker container restart` å‘½ä»¤ä¼šå°†ä¸€ä¸ªè¿è¡Œæ€çš„å®¹å™¨ç»ˆæ­¢ï¼Œç„¶åå†é‡æ–°å¯åŠ¨å®ƒã€‚

### `exec`è¿›å…¥å®¹å™¨

åœ¨ä½¿ç”¨ `-d` å‚æ•°æ—¶ï¼Œå®¹å™¨å¯åŠ¨åä¼šè¿›å…¥åå°ã€‚

æŸäº›æ—¶å€™éœ€è¦è¿›å…¥å®¹å™¨è¿›è¡Œæ“ä½œï¼Œæ¨èå¤§å®¶ä½¿ç”¨ `docker exec` å‘½ä»¤ï¼š

```shell
$ docker run -dit alpine
$ docker ps
CONTAINER ID        IMAGE                 COMMAND             CREATED             STATUS              PORTS                      NAMES
3d95dabef801        alpine                "/bin/sh"           21 seconds ago      Up 19 seconds                                  recursing_aryabhata
```

```shell
$ docker exec -it <CONTAINER ID>
```

å¦‚æœä»è¿™ä¸ª stdin ä¸­ exitï¼Œä¸ä¼šå¯¼è‡´å®¹å™¨çš„åœæ­¢ã€‚

###  åˆ é™¤å®¹å™¨

å¯ä»¥ä½¿ç”¨ `docker container rm` æ¥åˆ é™¤ä¸€ä¸ªå¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨ã€‚ä¾‹å¦‚

```shell
$ docker rm  <CONTAINER ID>
# åˆ é™¤è¿è¡Œä¸­çš„å®¹å™¨ï¼Œå¹¶åˆ é™¤å®¹å™¨æŒ‚è½½çš„æ•°æ®å·
$ docker rm -vf
```

å¦‚æœè¦åˆ é™¤ä¸€ä¸ªè¿è¡Œä¸­çš„å®¹å™¨ï¼Œå¯ä»¥æ·»åŠ  `-f` å‚æ•°ã€‚Docker ä¼šå‘é€ `SIGKILL` ä¿¡å·ç»™å®¹å™¨ã€‚

### æ¸…ç†æ‰€æœ‰å¤„äºç»ˆæ­¢çŠ¶æ€çš„å®¹å™¨

```shell
$ docker container prune
```

### å¯¼å‡ºå’Œå¯¼å…¥å®¹å™¨

```shell
$ docker export 7691a814370e > ubuntu.tar
$ cat ubuntu.tar | docker import - test/ubuntu:v1.0
$ docker import http://example.com/exampleimage.tgz example/imagerepo
```

### æŸ¥çœ‹å®¹å™¨

#### æŸ¥çœ‹å®¹å™¨è¯¦æƒ…

```shell
$ docker inspect [OPTIONS] <CONTAINER ID>
```

#### æŸ¥çœ‹å®¹å™¨å†…è¿›ç¨‹

```shell
$ docker top [OPTIONS] <CONTAINER ID>
```

#### æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯

```shell
$ docker stats [OPTIONS] <CONTAINER ID>
```

### æ›´æ–°é…ç½®

```shell
$ docker update --restart=always <CONTAINER ID>
```

### é‡å‘½åå®¹å™¨

```shell
$ docker rename <old name> <new name>
```

### æŸ¥çœ‹å®¹å™¨æ—¥å¿—

```shell
$ docker logs -f <CONTAINER ID>
```

### Portainer å®¹å™¨ç®¡ç†å·¥å…·

```shell
$ docker volume create portainer_data
$ docker run -d -p 9000:9000 \
		-v /var/run/docker.sock:/var/run/docker.sock \
		-v portainer_data:/data \
		--name portainer \
		--restart always \
		portainer/portainer
```

é…ç½® `/etc/nginx/sites-enabled/dafulat` æ–‡ä»¶ï¼š

```nginx
upstream portainer {
    server 127.0.0.1:9000;
}

server {
  listen 80;

  location /portainer/ {
      proxy_http_version 1.1;
      proxy_set_header Connection "";
      proxy_pass http://portainer/;
  }
  location /portainer/ws/ {
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection "upgrade";
      proxy_http_version 1.1;
      proxy_pass http://portainer/ws/;
  }
}
```

## Docker æ•°æ®æŒä¹…åŒ–

`æ•°æ®å·` æ˜¯ä¸€ä¸ªå¯ä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ä½¿ç”¨çš„ç‰¹æ®Šç›®å½•ï¼Œå®ƒç»•è¿‡ UFSï¼Œå¯ä»¥æä¾›å¾ˆå¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼š

- `æ•°æ®å·` å¯ä»¥åœ¨å®¹å™¨ä¹‹é—´å…±äº«å’Œé‡ç”¨
- å¯¹ `æ•°æ®å·` çš„ä¿®æ”¹ä¼šç«‹é©¬ç”Ÿæ•ˆ
- å¯¹ `æ•°æ®å·` çš„æ›´æ–°ï¼Œä¸ä¼šå½±å“é•œåƒ
- `æ•°æ®å·` é»˜è®¤ä¼šä¸€ç›´å­˜åœ¨ï¼Œå³ä½¿å®¹å™¨è¢«åˆ é™¤

### åˆ›å»ºæ•°æ®å·

```shell
$ docker volume create my-vol
```

é™¤äº† `create` å­å‘½ä»¤å¤–ï¼Œdocker volume è¿˜æ”¯æŒ `inspect`(æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯)ã€`ls`ï¼ˆåˆ—å‡ºå·²æœ‰æ•°æ®å·ï¼‰ã€`prune`ï¼ˆæ¸…ç†æ— ç”¨æ•°æ®å·ï¼‰ã€`rm`ï¼ˆåˆ é™¤æ•°æ®å·ï¼‰

### ç»‘å®šæ•°æ®å·

#### `--mount`

```bash
$ docker run -d -P \
    --name web \
    --mount source=my-vol,target=/webapp \
    training/webapp \
    python app.py
```

#### `-v`ï¼Œ`--volume`

```shell
$ docker run -d -P \
    --name web \
    -v my-vol:/wepapp \
    training/webapp \
    python app.py
```

> source ä¹Ÿå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„çš„ä»»æ„ç³»ç»Ÿä½ç½®ã€‚

> å¦‚æœç›´æ¥æŒ‚è½½ä¸€ä¸ªæ–‡ä»¶åˆ°å®¹å™¨ï¼Œä½¿ç”¨æ–‡ä»¶ç¼–è¾‘å·¥å…·ï¼ŒåŒ…æ‹¬ vi æˆ–è€… `sed --in-place` çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šé€ æˆæ–‡ä»¶ inode çš„æ”¹å˜ï¼Œä» Docker 1.1 èµ·ï¼Œè¿™ä¼šå¯¼è‡´æŠ¥é”™è¯¯ä¿¡æ¯ã€‚æ‰€ä»¥æ¨èçš„æ–¹å¼æ˜¯ç›´æ¥æŒ‚è½½æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•åˆ°å®¹å™¨å†…ã€‚

## Dockerfile

> è¯¦ç»†æŒ‡ä»¤è¯¦è§£è¯·æŸ¥çœ‹ï¼š[Dockerfile æŒ‡ä»¤è¯¦è§£](https://vuepress.mirror.docker-practice.com/image/dockerfile/)

![](https://i.loli.net/2020/04/11/hmlMV4QA2opON9j.png)

## åº”ç”¨å®‰è£…

### GitLab åŠå…¶å®˜æ–¹é•œåƒ

#### docker-compose.yml

```yaml
web:
  image: 'gitlab/gitlab-ce:latest'
  restart: always
  hostname: 'gitlab.yangjunning.pro'
  environment:
    GITLAB_OMNIBUS_CONFIG: |
      external_url 'http://gitlab.yangjunning.pro:8929'
      gitlab_rails['gitlab_shell_ssh_port'] = 2224
  ports:
    - '8929:8929'
    - '2224:22'
  volumes:
    - 'gitlab_config:/etc/gitlab'
    - 'gitlab_logs:/var/log/gitlab'
    - 'gitlab_data:/var/opt/gitlab'
```

#### è¿è¡Œå®¹å™¨

```
$ docker-compose up -d
```

#### æ›´æ–° gitlab

```shell
$ docker-compose pull
$ docker-compose up -d
```

## Docker ç›¸å…³çš„å®šæ—¶ä»»åŠ¡

```
# crontab -e
# æ¯å¤©å‡Œæ™¨å¼ºåˆ¶åˆ é™¤æ— ç”¨é•œåƒï¼Œä¸å…‰æ˜¯ä¸´æ—¶é•œåƒï¼›æ¯å¤©å‡Œæ™¨æ¸…ç†æ— ç”¨çš„æ•°æ®å·
00 00 * * * docker image prune -af && docker volume prune -f && rsync -arv /var/lib/docker/volumes /backups/docker
```

> qshell åŒæ­¥æ–‡ä»¶åˆ°ä¸ƒç‰›äº‘çš„é…ç½®è¯·å‚è€ƒ[å¤‡ä»½åˆ°ä¸ƒç‰›äº‘](https://juejin.im/post/5e81e2db518825737b4ad911#heading-59)

## æ¦‚å¿µ

### DevOps

DevOpsï¼ˆ**Dev**elopmentå’Œ**Op**erationsçš„ç»„åˆè¯ï¼‰æ˜¯ä¸€ç§é‡è§†è½¯ä»¶å¼€å‘äººå‘˜ï¼ˆDevï¼‰å’ŒITè¿ç»´æŠ€æœ¯äººå‘˜ï¼ˆOpsï¼‰ä¹‹é—´æ²Ÿé€šåˆä½œçš„æ–‡åŒ–ã€è¿åŠ¨æˆ–æƒ¯ä¾‹ã€‚é€è¿‡è‡ªåŠ¨åŒ–â€œè½¯ä»¶äº¤ä»˜â€å’Œâ€œæ¶æ„å˜æ›´â€çš„æµç¨‹ï¼Œæ¥ä½¿å¾—æ„å»ºã€æµ‹è¯•ã€å‘å¸ƒè½¯ä»¶èƒ½å¤Ÿæ›´åŠ åœ°å¿«æ·ã€é¢‘ç¹å’Œå¯é ã€‚

DevOps çš„å¼•å…¥èƒ½å¯¹äº§å“äº¤ä»˜ã€[æµ‹è¯•](https://zh.wikipedia.org/wiki/æµ‹è¯•)ã€åŠŸèƒ½å¼€å‘å’Œ[ç»´æŠ¤](https://zh.wikipedia.org/wiki/è»Ÿé«”ç¶­è­·)ï¼ˆåŒ…æ‹¬æ›¾ç»ç½•è§ä½†å¦‚ä»Šå·²å±¡è§ä¸é²œçš„â€œ[çƒ­è¡¥ä¸](https://zh.wikipedia.org/wiki/Hot_fix)â€ï¼‰èµ·åˆ°æ„ä¹‰æ·±è¿œçš„å½±å“ã€‚åœ¨ç¼ºä¹ DevOps èƒ½åŠ›çš„ç»„ç»‡ä¸­ï¼Œå¼€å‘ä¸è¿è¥ä¹‹é—´å­˜åœ¨ç€ä¿¡æ¯â€œé¸¿æ²Ÿâ€ã€‚ä¾‹å¦‚è¿è¥äººå‘˜è¦æ±‚æ›´å¥½çš„å¯é æ€§å’Œå®‰å…¨æ€§ï¼Œå¼€å‘äººå‘˜åˆ™å¸Œæœ›[åŸºç¡€è®¾æ–½](https://zh.wikipedia.org/wiki/åŸºç¡€è®¾æ–½)å“åº”æ›´å¿«ï¼Œè€Œä¸šåŠ¡ç”¨æˆ·çš„éœ€æ±‚åˆ™æ˜¯æ›´å¿«åœ°å°†æ›´å¤šçš„ç‰¹æ€§å‘å¸ƒç»™æœ€ç»ˆç”¨æˆ·ä½¿ç”¨ã€‚è¿™ç§ä¿¡æ¯é¸¿æ²Ÿå°±æ˜¯æœ€å¸¸å‡ºé—®é¢˜çš„åœ°æ–¹ã€‚

### è™šæ‹ŸåŒ–

åœ¨è®¡ç®—æœºæŠ€æœ¯ä¸­ï¼Œè™šæ‹ŸåŒ–æ˜¯ä¸€ç§èµ„æºç®¡ç†æŠ€æœ¯ï¼Œæ˜¯å°†è®¡ç®—æœºä¸­çš„å„ç§å®ä½“èµ„æºï¼Œå¦‚æœåŠ¡å™¨ã€ç½‘ç»œã€å†…å­˜åŠå­˜å‚¨ç­‰ï¼Œäºˆä»¥æŠ½è±¡ã€è½¬æ¢åå‘ˆç°å‡ºæ¥ï¼Œæ‰“ç ´å®ä½“ç»“æ„é—´çš„ä¸å¯åˆ‡å‰²çš„éšœç¢ï¼Œä½¿ç”¨æˆ·å¯ä»¥ç”¨æ¯”åŸæ¥çš„ç»„æ€æ›´å¥½çš„æ–¹å¼æ¥åº”ç”¨è¿™äº›èµ„æºã€‚

### å®¹å™¨

å®¹å™¨æœ‰æ•ˆåœ°å°†ç”±å•ä¸ªæ“ä½œç³»ç»Ÿç®¡ç†çš„èµ„æºåˆ’åˆ†åˆ°å­¤ç«‹çš„ç»„ä¸­ï¼Œä»¥æ›´å¥½åœ°åœ¨å­¤ç«‹çš„ç»„ä¹‹é—´å¹³è¡¡æœ‰å†²çªçš„èµ„æºä½¿ç”¨éœ€æ±‚ã€‚ä¸è™šæ‹ŸåŒ–ç›¸æ¯”ï¼Œè¿™æ ·æ—¢ä¸éœ€è¦æŒ‡ä»¤çº§æ¨¡æ‹Ÿï¼Œä¹Ÿä¸éœ€è¦å³æ—¶ç¼–è¯‘ã€‚å®¹å™¨å¯ä»¥åœ¨æ ¸å¿ƒ CPU æœ¬åœ°è¿è¡ŒæŒ‡ä»¤ï¼Œè€Œä¸éœ€è¦ä»»ä½•ä¸“é—¨çš„è§£é‡Šæœºåˆ¶ã€‚æ­¤å¤–ï¼Œä¹Ÿé¿å…äº†å‡†è™šæ‹ŸåŒ–ï¼ˆpara-virtualizationï¼‰å’Œç³»ç»Ÿè°ƒç”¨æ›¿æ¢ä¸­çš„å¤æ‚æ€§ã€‚

### åˆ†å±‚å­˜å‚¨

å› ä¸ºé•œåƒåŒ…å«æ“ä½œç³»ç»Ÿå®Œæ•´çš„ `root` æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶ä½“ç§¯å¾€å¾€æ˜¯åºå¤§çš„ï¼Œå› æ­¤åœ¨ Docker è®¾è®¡æ—¶ï¼Œå°±å……åˆ†åˆ©ç”¨ [Union FS](https://en.wikipedia.org/wiki/Union_mount) çš„æŠ€æœ¯ï¼Œå°†å…¶è®¾è®¡ä¸ºåˆ†å±‚å­˜å‚¨çš„æ¶æ„ã€‚æ‰€ä»¥ä¸¥æ ¼æ¥è¯´ï¼Œé•œåƒå¹¶éæ˜¯åƒä¸€ä¸ª ISO é‚£æ ·çš„æ‰“åŒ…æ–‡ä»¶ï¼Œé•œåƒåªæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ¦‚å¿µï¼Œå…¶å®é™…ä½“ç°å¹¶éç”±ä¸€ä¸ªæ–‡ä»¶ç»„æˆï¼Œè€Œæ˜¯ç”±ä¸€ç»„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œæˆ–è€…è¯´ï¼Œç”±å¤šå±‚æ–‡ä»¶ç³»ç»Ÿè”åˆç»„æˆã€‚

é•œåƒæ„å»ºæ—¶ï¼Œä¼šä¸€å±‚å±‚æ„å»ºï¼Œå‰ä¸€å±‚æ˜¯åä¸€å±‚çš„åŸºç¡€ã€‚æ¯ä¸€å±‚æ„å»ºå®Œå°±ä¸ä¼šå†å‘ç”Ÿæ”¹å˜ï¼Œåä¸€å±‚ä¸Šçš„ä»»ä½•æ”¹å˜åªå‘ç”Ÿåœ¨è‡ªå·±è¿™ä¸€å±‚ã€‚æ¯”å¦‚ï¼Œåˆ é™¤å‰ä¸€å±‚æ–‡ä»¶çš„æ“ä½œï¼Œå®é™…ä¸æ˜¯çœŸçš„åˆ é™¤å‰ä¸€å±‚çš„æ–‡ä»¶ï¼Œè€Œæ˜¯ä»…åœ¨å½“å‰å±‚æ ‡è®°ä¸ºè¯¥æ–‡ä»¶å·²åˆ é™¤ã€‚åœ¨æœ€ç»ˆå®¹å™¨è¿è¡Œçš„æ—¶å€™ï¼Œè™½ç„¶ä¸ä¼šçœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œä½†æ˜¯å®é™…ä¸Šè¯¥æ–‡ä»¶ä¼šä¸€ç›´è·Ÿéšé•œåƒã€‚å› æ­¤ï¼Œåœ¨æ„å»ºé•œåƒçš„æ—¶å€™ï¼Œéœ€è¦é¢å¤–å°å¿ƒï¼Œæ¯ä¸€å±‚å°½é‡åªåŒ…å«è¯¥å±‚éœ€è¦æ·»åŠ çš„ä¸œè¥¿ï¼Œä»»ä½•é¢å¤–çš„ä¸œè¥¿åº”è¯¥åœ¨è¯¥å±‚æ„å»ºç»“æŸå‰æ¸…ç†æ‰ã€‚

åˆ†å±‚å­˜å‚¨çš„ç‰¹å¾è¿˜ä½¿å¾—é•œåƒçš„å¤ç”¨ã€å®šåˆ¶å˜çš„æ›´ä¸ºå®¹æ˜“ã€‚ç”šè‡³å¯ä»¥ç”¨ä¹‹å‰æ„å»ºå¥½çš„é•œåƒä½œä¸ºåŸºç¡€å±‚ï¼Œç„¶åè¿›ä¸€æ­¥æ·»åŠ æ–°çš„å±‚ï¼Œä»¥å®šåˆ¶è‡ªå·±æ‰€éœ€çš„å†…å®¹ï¼Œæ„å»ºæ–°çš„é•œåƒã€‚

### å®ˆæŠ¤è¿›ç¨‹ daemon

åœ¨ä¸€ä¸ªå¤šä»»åŠ¡çš„ç”µè„‘æ“ä½œç³»ç»Ÿä¸­ï¼Œå®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonï¼‰æ˜¯ä¸€ç§åœ¨åå°æ‰§è¡Œçš„ç”µè„‘ç¨‹åºã€‚æ­¤ç±»ç¨‹åºä¼šè¢«ä»¥è¿›ç¨‹çš„å½¢å¼åˆå§‹åŒ–ã€‚å®ˆæŠ¤è¿›ç¨‹ç¨‹åºçš„åç§°é€šå¸¸ä»¥å­—æ¯â€dâ€œç»“å°¾ï¼šä¾‹å¦‚ï¼Œ`syslogd` å°±æ˜¯æŒ‡ç®¡ç†ç³»ç»Ÿæ—¥å¿—çš„å®ˆæŠ¤è¿›ç¨‹ã€‚

é€šå¸¸ï¼Œå®ˆæŠ¤è¿›ç¨‹æ²¡æœ‰ä»»ä½•å­˜åœ¨çš„çˆ¶è¿›ç¨‹ï¼ˆå³PPID=1ï¼‰ï¼Œä¸”åœ¨ UNIX ç³»ç»Ÿè¿›ç¨‹å±‚çº§ä¸­ç›´æ¥ä½äº init ä¹‹ä¸‹ã€‚å®ˆæŠ¤è¿›ç¨‹ç¨‹åºé€šå¸¸é€šè¿‡å¦‚ä¸‹æ–¹æ³•æ˜¯è‡ªå·±æˆä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼šå¯¹ä¸€ä¸ªå­è¿›ç¨‹è¿›è¡Œ forkï¼Œç„¶åä½¿å…¶çˆ¶è¿›ç¨‹ç«‹å³ç»ˆæ­¢ï¼Œä½¿å¾—è¿™ä¸ªå­è¿›ç¨‹èƒ½åœ¨ init ä¸‹è¿è¡Œã€‚è¿™ç§æ–¹æ³•é€šå¸¸è¢«ç§°ä¸ºâ€è„±å£³â€œã€‚

ç³»ç»Ÿé€šå¸¸åœ¨å¯åŠ¨æ—¶ä¸€åŒå¼•å¯¼å®ˆæŠ¤è¿›ç¨‹ã€‚å®ˆæŠ¤è¿›ç¨‹ä¸ºå¯¹ç½‘ç»œè¯·æ±‚ï¼Œç¡¬ä»¶æ´»åŠ¨ç­‰è¿›è¡Œå“åº”ï¼Œæˆ–å…¶ä»–é€šè¿‡æŸäº›ä»»åŠ¡å¯¹å…¶ä»–åº”ç”¨ç¨‹åºçš„è¯·æ±‚è¿›è¡Œå›åº”æä¾›æ”¯æŒã€‚å®ˆæŠ¤è¿›ç¨‹ä¹Ÿèƒ½å¤Ÿå¯¹ç¡¬ä»¶è¿›è¡Œé…ç½®ï¼ˆå¦‚æŸäº›Linuxç³»ç»Ÿä¸Šçš„devfsdï¼‰ï¼Œè¿è¡Œè®¡åˆ’ä»»åŠ¡ï¼ˆä¾‹å¦‚cronï¼‰ï¼Œä»¥åŠè¿è¡Œå…¶ä»–ä»»åŠ¡ã€‚

åœ¨ DOS ç¯å¢ƒä¸­ï¼Œæ­¤ç±»åº”ç”¨ç¨‹åºè¢«ç§°ä¸ºé©»ç•™ç¨‹åºï¼ˆTSRï¼‰ã€‚åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œç”±ç§°ä¸º WindowsæœåŠ¡çš„åº”ç”¨ç¨‹åºæ¥å±¥è¡Œå®ˆæŠ¤è¿›ç¨‹çš„èŒè´£ã€‚

åœ¨åŸæœ¬çš„ Mac OS ç³»ç»Ÿä¸­ï¼Œæ­¤ç±»åº”ç”¨ç¨‹åºè¢«ç§°ä¸ºâ€extensionsâ€œã€‚è€Œä½œä¸º Unux-like çš„ Mac OS X æœ‰å®ˆæŠ¤è¿›ç¨‹ã€‚

### Docker ä¸è™šæ‹Ÿæœºæ¯”è¾ƒ

| ç‰¹æ€§       | å®¹å™¨               | è™šæ‹Ÿæœº      |
| ---------- | ------------------ | ----------- |
| å¯åŠ¨       | ç§’çº§               | åˆ†é’Ÿçº§      |
| ç¡¬ç›˜ä½¿ç”¨   | ä¸€èˆ¬ä¸º `MB`        | ä¸€èˆ¬ä¸º `GB` |
| æ€§èƒ½       | æ¥è¿‘åŸç”Ÿ           | å¼±äº        |
| ç³»ç»Ÿæ”¯æŒé‡ | å•æœºæ”¯æŒä¸Šåƒä¸ªå®¹å™¨ | ä¸€èˆ¬å‡ åä¸ª  |

å¦‚ä¸‹å›¾ï¼Œè™šæ‹Ÿæœºæ˜¯åœ¨ç¡¬ä»¶å±‚é¢å®ç°è™šæ‹ŸåŒ–ï¼Œéœ€è¦é¢å¤–çš„è™šæ‹Ÿæœºç®¡ç†åº”ç”¨å’Œè™šæ‹Ÿæœºæ“ä½œç³»ç»Ÿå±‚ã€‚Dockerå®¹å™¨æ˜¯åœ¨æ“ä½œç³»ç»Ÿå±‚é¢ä¸Šå®ç°è™šæ‹ŸåŒ–ï¼Œç›´æ¥å¤ç”¨æœ¬åœ°ä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼Œå› æ­¤æ›´åŠ è½»é‡çº§ã€‚

![](https://i.loli.net/2020/03/31/mZiyHL2kGAgrMFx.png)

## æ‰©å±•é˜…è¯»

- [DevOps çŸ¥è¯†å¹³å° Ledge](https://devops.phodal.com/)
- [jenkins+docker æŒç»­é›†æˆ](https://juejin.im/post/5b6af759e51d451951138eb4#heading-7)

## å¾…å®è·µ

- SonarQube
- Nexus Repository Manager
- ShowDoc
- Verdaccio
- EasyMock
- Sentry
- Ansible
- code-push-server
- BugOut

## Catch Me

> GitHub: [youngjuning](https://github.com/youngjuning) | å¾®ä¿¡: `yang_jun_ning` | å…¬ä¼—å·: `å‰ç«¯æ—©èŒ¶é¦†` | é‚®ç®±: youngjuning@aliyun.com

|                             å¾®ä¿¡                             |                             æŠ•é£Ÿ                             |                            å…¬ä¼—å·                            |
| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
| <img src="https://i.loli.net/2020/02/22/q2tLiGYvhIxm3Fl.jpg" width="200px"/> | <img src="https://i.loli.net/2020/02/23/q56X1eYZuITQpsj.png" width="200px"/> | <img src="https://i.loli.net/2020/07/28/6AyutjZ1XI4aUDV.jpg" width="200px"/> |

æœ¬æ–‡é¦–å‘äº[æ¨ä¿Šå®çš„åšå®¢](https://youngjuning.js.org/)ï¼Œåˆ›ä½œä¸æ˜“ï¼Œæ‚¨çš„ç‚¹èµğŸ‘æ˜¯æˆ‘åšæŒçš„åŠ¨åŠ›ï¼ï¼ï¼
