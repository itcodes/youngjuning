---
title: 前端规范化开发实践
date: 2020-03-24 22:53:11
tags:
---

![](https://i.loli.net/2020/03/24/EKCvkLJZNtfBrpu.png)

<!--more-->

本文以 React Native 项目为示例介绍了前端规范化开发涉及的工具及知识，但是所涉及内容具有通用性，建议读者点赞收藏(*^▽^*)。

> 另外安利一下 [@sigmayun/react-native-template-typescript](https://github.com/sigmayun/react-native-template-typescript)，这是一个基于 typescript 的 react native 开箱即用的模板。本文所涉及的大部分内容都集成到了该模板中。

## gitconfig

```sh
# 初始化设置
$ git config --global user.name 'your_name'
$ git config --global user.email 'your_email@aliyun.com'
# 提高命令输出的可读性
$ git config --global color.ui auto
# git 记住用户名和密码
$ git config --global credential.helper store
# core.autocrlf
$ git config --global core.autocrlf input
```

以上配置内容可以在 `~/.gitconfig` 文件中找到。

## npm scripts

`package.json` 文件的 scripts 字段是定义可执行脚本用的，可以利用它来实现简单的工作流。如果不是大型的项目，不建议使用 gulp，npm scripts 一样可以完成工作流设计的任务。下面是 React Native 项目默认的 scripts，如今我们可以把使用和扩展 scripts 看做是前端基本功。

```json
{
  "scripts": {
    "android": "react-native run-android",
    "ios": "react-native run-ios",
    "start": "react-native start",
    "test": "jest",
    "lint": "eslint ."
  }
}
```

## 使用 EditorConfig 实现跨编辑器代码风格统一

```
# EditorConfig is awesome: http://EditorConfig.org

# top-most EditorConfig file
root = true

# Unix-style newlines with a newline ending every file
[*]
indent_style = space
indent_size = 2
end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

[*.md]
trim_trailing_whitespace = false

[*.gradle]
indent_size = 4

[BUCK]
indent_size = 4
```

## 使用ESLint规范代码

> 作者自己团队的 ESLint 方案是基于 eslint-config-airbnb 扩展的，有兴趣可以体验一下 [@sishuguojixuefu/eslint-config](https://github.com/sishuguojixuefu/eslint-config)

### 安装依赖

```sh
# 安装 eslint-config-airbnb 及其 peerDependencies
$ yarn global add install-peerdeps
$ install-peerdeps -D eslint-config-airbnb
# 支持 react-native
$ yarn add -D eslint-plugin-react-native
# 支持 typescript
$ yarn add -D @typescript-eslint/parser @typescript-eslint/eslint-plugin eslint-import-resolver-typescript typescript
# 支持 prettier
$ yarn add -D prettier eslint-plugin-prettier eslint-config-prettier
# 其他
$ yarn add -D eslint-plugin-promise eslint-plugin-you-dont-need-lodash-underscore eslint-plugin-you-dont-need-momentjs
```

### package.json

```json
{
   "eslintConfig": {
    "extends": [
      "airbnb",
      "airbnb/hooks",
      "plugin:react-native/all",
      "plugin:@typescript-eslint/recommended",
      "plugin:promise/recommended",
      "plugin:you-dont-need-lodash-underscore/compatible",
      "plugin:you-dont-need-momentjs/recommended",
      "plugin:prettier/recommended",
      "prettier",
      "prettier/react",
      "prettier/@typescript-eslint"
    ],
    "env": {
      "react-native/react-native": true
    },
    "parser": "@typescript-eslint/parser",
    "parserOptions": {
      "ecmaFeatures": {
        "jsx": true
      }
    },
    "settings": {
      "import/extensions": [".js", ".ts", ".tsx"],
      "import/resolver": {
        "typescript": {
          "alwaysTryTypes": true
        }
      }
    }
  }
}
```

### .prettierrc.js

```js
module.exports = {
  printWidth: 150, // 一行的字符数，如果超过会进行换行，默认为80
  tabWidth: 2, // tab缩进大小,默认为2
  useTabs: false, // 使用tab缩进，默认false
  semi: false, // 使用分号, 默认true
  /**
   * 行尾逗号,默认none,可选 none|es5|all
   * es5 包括es5中的数组、对象
   * all 包括函数对象等所有可选
   */
  trailingComma: 'es5',
  singleQuote: true, // 使用单引号, 默认false(在jsx中配置无效, 默认都是双引号)
  /**
   * 对象中的空格 默认true
   * true: { foo: bar }
   * false: {foo: bar}
   */
  bracketSpacing: true,
  /**
   * JSX标签闭合位置 默认false
   * false:
   * <div
   *  className=""
   *  style={{}}
   * >
   * true:
   * <div
   *  className=""
   * style={{}} >
   */
  jsxBracketSameLine: false,
  /**
   * 箭头函数参数括号 默认avoid 可选 avoid| always
   * avoid 能省略括号的时候就省略 例如x => x
   * always 总是有括号
   */
  arrowParens: 'avoid',
  vueIndentScriptAndStyle: false, // vue 文件 script 和 style 标签缩进，默认false
  endOfLine: 'lf', // 强制使用 unix 风格的换行符
}
```

### 插件介绍

- eslint-config-airbnb: 该软件包提供 Airbnb 的 .eslintrc 作为可扩展的共享配置
- eslint-plugin-react-native: 针对 ESLint 的 React Native 特定 linting 规则
- @typescript-eslint/parser: 将 TypeScript 转换为 ESTree，使 eslint 可以识别
- @typescript-eslint/eslint-plugin: 一个包含一堆特定于 TypeScript 的 ESLint 规则的插件
- eslint-import-resolver-typescript: 给 eslint-plugin-import 添加 typescript 支持的插件
- eslint-plugin-prettier: 以 ESLint 插件的形式运行 prettier
- eslint-config-prettier: 关闭所有不必要或可能与 prettier 的规则冲突的 ESLint 规则。一定要放到最后。

### vscode eslint plugin config

```json
"editor.codeActionsOnSave": {
  "source.fixAll.eslint": true
},
"eslint.lintTask.enable": true,
"eslint.packageManager": "yarn",
"eslint.alwaysShowStatus": true,
"eslint.validate": [
  "javascript",
  "javascriptreact",
  "typescript",
  "typescriptreact",
  "vue",
  "html"
]
```

## 用 husky 和 lint-staged 构建超溜的代码检查工作流

```sh
$ yarn add -D husky
```

```json
{
  "husky": {
    "hooks": {
      "pre-commit": "tsc --noEmit && lint-staged"
    }
  },
  "lint-staged": {
    "**/*.{js,jsx,ts,tsx}": [
      "eslint --fix",
      "git add"
    ],
    "**/*.{md,json}": [
      "prettier --write",
      "git add"
    ]
  }
}
```

## Conventional Commits 约定式提交规范

[Conventional Commits](https://www.conventionalcommits.org/zh-hans/v1.0.0-beta.4/) 是一种用于给提交信息增加人机可读含义的规范。约定式提交规范是一种基于消息的轻量级约定。它提供了一组用于创建清晰的提交历史的简单规则；这使得编写基于规范的自动化工具变得更容易。这个约定与 [SemVer](http://semver.org/) 相吻合，在提交信息中描述新特性、bug 修复和破坏性变更。

提交说明的结构如下所示：

```
<类型>[可选的作用域]: <描述>

[可选的正文]

[可选的脚注]
```

- [conventional-changelog](https://github.com/conventional-changelog): 用于从项目的提交消息和元数据生成变更日志和发行说明的工具。
  - [conventional-changelog-cli](https://github.com/conventional-changelog/conventional-changelog/tree/master/packages/conventional-changelog-cli): 从git元数据生成变更日志
  - [commitlint](https://commitlint.js.org/): 📓 Lint commit messages
